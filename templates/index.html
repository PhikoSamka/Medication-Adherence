<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediPredict - Medication Adherence Predictor</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js" defer></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!--- Pdf generation -->
    <!-- html2pdf.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</head>
<body x-data="adherenceApp()">

<!-- Header -->
<header class="sticky top-0 z-50 bg-white shadow-sm border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
        <a href="#" class="text-2xl font-bold text-blue-700 tracking-wide flex items-center">
            <i class="fas fa-heart-pulse text-2xl mr-2 text-teal-500"></i>
            MediPredict
        </a>
        <nav class="space-x-6 text-gray-600 font-medium hidden sm:flex">
            <a href="{{ url_for('home') }}" class="hover:text-blue-600 transition duration-150">Home</a>
            <a href="{{ url_for('about') }}" class="hover:text-blue-600 transition duration-150">About</a>
            <a href="#contact" class="hover:text-blue-600 transition duration-150">Contact</a>
        </nav>
        
        <button class="sm:hidden text-gray-600 text-xl"><i class="fas fa-bars"></i></button>
    </div>
</header>

<main class="py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">

        <!-- Hero Section -->
        <div class="hero-background p-10 md:p-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 max-w-3xl">
                Predict Your <span class="text-blue-700">Medication Adherence</span>
            </h1>
            <p class="text-lg text-gray-600 mb-8 max-w-xl">
                Understand and improve your health journey with data-driven insights.
            </p>
            <button
            @click="scrollToForm()"
            class="bg-blue-600 text-white font-semibold text-lg rounded-lg px-6 py-3 shadow-md hover:bg-blue-700 hover:shadow-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
        >
            Begin Assessment
        </button>
        
        </div>

        <!-- Form & Results Section -->
        <section id="form" class="scroll-mt-header p-8 md:p-12">
            <div class="grid lg:grid-cols-2 gap-8">

                <!-- Left Column: Input Form -->
                <div class="pr-4 border-r lg:border-gray-100 lg:pr-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Patient Input Form</h2>

                    <form action="/predict" method="POST" @submit.prevent="predictAdherence()">
                        
                        <!-- Demographics -->
                        <div class="space-y-4 mb-6">
                            <div class="flex items-center">
                                <label for="age" class="w-2/5 text-sm font-medium text-gray-700">Age</label>
                                <input x-model.number="age" type="number" id="age" name="age" min="1" max="120" placeholder="45" required class="w-1/4 border border-gray-300 rounded-md shadow-sm p-1.5 text-center text-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                            </div>

                            <div class="flex items-center">
                                <label class="w-2/5 text-sm font-medium text-gray-700">Gender</label>
                                <div class="flex space-x-4">
                                    <template x-for="g in ['Male', 'Female', 'Other']" :key="g">
                                        <label class="inline-flex items-center cursor-pointer">
                                            <input type="radio" x-model="gender" :value="g" :id="g" name="gender" class="form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                            <span class="ml-1 text-sm text-gray-700" x-text="g"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>

                            <div class="flex items-center">
                                <label for="period" class="w-2/5 text-sm font-medium text-gray-700">Duration (months)</label>
                                <input x-model.number="period" type="number" id="period" name="prescription_period" min="1" placeholder="3" required class="w-1/4 border border-gray-300 rounded-md shadow-sm p-1.5 text-center text-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150">
                            </div>
                        </div>

                        <!-- Risk Factors -->
                        <div class="mb-8 border-t pt-4 border-gray-100">
                            <legend class="text-base font-semibold text-gray-800 mb-4">Risk Factors</legend>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <template x-for="factor in riskFactors" :key="factor.key">
                                    <label class="flex items-center justify-between p-2 rounded-lg cursor-pointer transition duration-150"
                                        :class="factor.model ? 'bg-red-50' : 'bg-blue-50 hover:bg-blue-100'">
                                        <span class="text-sm font-medium" :class="factor.model ? 'text-red-700' : 'text-blue-700'" x-text="factor.label"></span>
                                        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                            <input type="checkbox" :id="factor.key" x-model="factor.model" class="toggle-bg sr-only">
                                            <div class="toggle-switch block bg-blue-200 w-full h-5 rounded-full border-2 border-blue-200"></div>
                                        </div>
                                    </label>
                                </template>
                            </div>

                            <!-- Interventions -->
                            <legend class="text-base font-semibold text-gray-800 mb-4 border-t pt-4 border-gray-100">Interventions</legend>
                            <label class="flex items-center space-x-3 bg-blue-50 p-3 rounded-lg border border-blue-200 hover:bg-blue-100 transition duration-150 cursor-pointer">
                                <input type="checkbox" x-model="smsReminder" class="h-4 w-4 text-blue-600 border-blue-300 rounded focus:ring-blue-600">
                                <span class="text-sm font-medium text-blue-700">SMS Reminder Enabled</span>
                            </label>
                        </div>

                        <!-- Submit Button -->
                        <button
                        type="submit"
                        @click.prevent="predictAdherence()"
                        class="w-full bg-blue-600 text-white font-semibold text-lg rounded-xl py-3 shadow-md hover:bg-blue-700 hover:shadow-xl transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50"
                    >
                        Submit
                    </button>
                    
                    </form>
                </div>

                <!-- Right Column: Results -->
                <div x-show="showResult" x-transition:enter="transition ease-out duration-500" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
                    <div :class="{'bg-green-50 border-green-400': isAdhering, 'bg-red-50 border-red-400': !isAdhering}" class="border-t-4 rounded-xl p-6 shadow-lg transition duration-500 mb-6">
                        <h3 :class="{'text-green-800': isAdhering, 'text-red-800': !isAdhering}" class="text-2xl font-extrabold mb-3">
                            Prediction Result
                        </h3>

                        <p :class="{'text-green-900': isAdhering, 'text-red-900': !isAdhering}" class="text-3xl font-bold mb-4">
                            <span x-text="isAdhering ? 'Likely to adhere' : 'Unlikely to adhere'"></span>
                        </p>

                        <div class="space-y-2">
                            <p class="text-sm font-medium text-gray-700">Confidence: <span x-text="confidence.toFixed(1) + '%'"></span></p>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div :class="{'bg-green-500': isAdhering, 'bg-red-500': !isAdhering}" :style="`width: ${confidence}%;`" class="h-3 rounded-full transition-all duration-700"></div>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 bg-gray-50 rounded-xl border border-gray-200">
                        <h4 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-teal-600"></i> Model Insights
                        </h4>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="flex flex-col p-3 bg-white rounded-lg border border-gray-200 shadow-sm">
                                <span class="text-sm text-gray-600 font-medium">IoD</span>
                                <p class="text-3xl font-extrabold text-blue-700 mt-1" x-text="iod + '%'"></p> 
                            </div>
                            <div class="flex flex-col p-3 bg-white rounded-lg border border-gray-200 shadow-sm">
                                <span class="text-sm text-gray-600 font-medium">F1-Score</span>
                                <p class="text-3xl font-extrabold text-blue-700 mt-1" x-text="f1 + '%'"></p>
                            </div>
                        </div>

                        <h5 class="text-base font-semibold text-gray-700 mt-4 mb-2 border-t pt-4">Risk Factor Impact</h5>
                        
                        <div class="h-64">
                            <canvas id="riskChart" class="mt-6"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="p-8 border-t border-gray-100 mt-8">
            <div class="flex flex-wrap justify-center sm:justify-between text-sm text-gray-600">
                <p>&copy; 2025 MediPredict. | All rights reserved. Developed by Phikolomzi Samka.</p>   
                <div class="space-x-4 mt-4 sm:mt-0">
                    <a href="https://github.com/PhikoSamka/Medication-Adherence" class="hover:text-blue-600 transition duration-150"><i class="fab fa-github mr-1"></i> Github</a>
                    <a href="#" class="hover:text-blue-600 transition duration-150">Support</a>
                    <a href="#" class="hover:text-blue-600 transition duration-150">Privacy</a>
                </div>
            </div>
        </footer>

    </div>
</main>

<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
